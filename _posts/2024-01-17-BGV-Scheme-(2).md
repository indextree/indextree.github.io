---
title: BGV (2) - Linearization
author: 000wan
date: 2024-01-23
categories: [HE, FHE, BGV]
tags: [HE, FHE, BGV]
pin: false
math: true
mermaid: true
image:
  path: /assets/img/bgv.png
  alt: BGV by DALL-E
---

## Intro

ì§€ë‚œ í¬ìŠ¤íŠ¸ì—ì„œëŠ” BGV schemeì˜ ê°œë…ê³¼ ê¸°ë³¸ì ì¸ ì•”í˜¸ë¬¸ ì—°ë¬¸ (ë§ì…ˆ, ê³±ì…ˆ) ì— ëŒ€í•´ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” BGV schemeì˜ í•µì‹¬ ê°œë… ì¤‘ í•˜ë‚˜ì¸ 'Dimension reduction'ê³¼ 'Linearization'ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

## Multiplication on BGV

ì´ì „ í¬ìŠ¤íŠ¸ì—ì„œ ë‹¤ë£¨ì—ˆë˜ BGVì—ì„œì˜ ì•”í˜¸ë¬¸ ê³±ì…ˆì„ ë³µê¸°í•´ë³´ê² ìŠµë‹ˆë‹¤.
ë‘ ciphertext

$$\mathbf{c}=(a_0, a_1, \cdots, a_n), \mathbf{c'}=(a'_0, a'_1, \cdots, a'_n)$$

ì— ëŒ€í•´, ë‘ ciphertextì˜ tensor productë¥¼ ê³„ì‚°í–ˆìŠµë‹ˆë‹¤.

$$c_{mul}=c\otimes c'=(b_{0, 0}, b_{0, 1}, \cdots, b_{i, j}, \cdots, b_{n, n})\in \mathbb{Z}_q^{(n+1)^2}$$

$$(b_{i, j}=a_ia'_j \mod{q}\quad \forall\ 0\le i,j\le n)$$

ì´ ë•Œ

$$r_{mul}=b_{0,0}+\sum_{i=1}^{n}(b_{0,i}+b_{i,0})s_i+\sum_{i,j}^{n}b_{i,j}(s_is_j)=rr'\mod{q}$$

ë¥¼ ìœ ë„í–ˆìŠµë‹ˆë‹¤.
ë”°ë¼ì„œ, $n$ dimension ë²¡í„° $\mathbf{s}$ì™€ $n^2$ dim ë²¡í„° $\mathbf{s}\otimes\mathbf{s}$ ë¥¼ secret keyë¡œ ì‚¬ìš©í•˜ë©´ $c_{mul}$ì„ ì˜¬ë°”ë¥´ê²Œ ë³µí˜¸í™” í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Two issues?

ì´ ë•Œ ë‘ê°€ì§€ ë¬¸ì œì ì´ ì–¸ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤:
- ciphertextì™€ secret keyì˜ dimensionì´ $n$ì—ì„œ $n^2$ìœ¼ë¡œ ì¦ê°€í•¨ (=> Dimension Reduction)
- ê³±ì…ˆì„ í• ë•Œë§ˆë‹¤ noiseê°€ ì¦ê°€í•¨ (=> Noise Reduction)

ì´ ê¸€ì—ì„œëŠ” ì²«ë²ˆì§¸ ë¬¸ì œë¥¼ ë‹¤ë£¨ë©°, ciphertextì™€ secret keyë¥¼ $n$ dimensionìœ¼ë¡œ ì¤„ì´ëŠ” íƒì›”í•œ ì•„ì´ë””ì–´(Linearization)ë¥¼ ê¸°ìˆ í•©ë‹ˆë‹¤. 

## Linearization

$\mathbf{s}\otimes\mathbf{s}$ ë¡œ ì•”í˜¸í™”ëœ ciphertextë¥¼, ë™ì¼í•œ ë©”ì„¸ì§€ì˜ $\mathbf{s}$ ë¡œ ì•”í˜¸í™”ëœ ciphertextë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.
ì´ë¥¼ ìœ„í•´ Linearization Gadgetì´ë¼ëŠ” ìƒˆë¡œìš´ ë²¡í„°ë¥¼ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.

### Linearization Gadget

> **Note**
> í¸ì˜ë¥¼ ìœ„í•´ ë²¡í„° í‘œê¸°ë²•ê³¼ dot product $\cdot$ ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.

Gadgetë“¤ì€ $s\otimes s$ ë¥¼ $s$ë¡œ ì•”í˜¸í™”í•œ ë²¡í„°ì…ë‹ˆë‹¤. ì¦‰ ëª¨ë“  $0\le i,j\le n$ì— ëŒ€í•´, $s_is_j$ë¥¼ BGVì˜ ì•”í˜¸í™” ê³¼ì •ì„ ë”°ë¼ ì•”í˜¸í™”í•©ë‹ˆë‹¤.

1. $\mathbf{w_{ij1}} \leftarrow U(\mathbb{Z}^n_q)$ ì˜ ëœë¤ ë²¡í„°ì™€ $e_{ij}\leftarrow D_{\sigma}$ ì˜ ëœë¤ ë…¸ì´ì¦ˆë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

2. $r_{ij} := s_is_j+2e_{ij}$ ì— ëŒ€í•´, $w_{ij0} := -\mathbf w_{ij1}\cdot \mathbf s + r_{ij}$ ë¡œ ì •ì˜í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ì•”í˜¸ë¬¸ $\mathbf w_{ij}=(w_{ij0}, \mathbf w_{ij1})$ ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ $\mathbf w_{ij}$ ì´ Linearization Gadgetì…ë‹ˆë‹¤.

### Process
ì´ì œ Linearization ê³¼ì •ì€ ê°„ë‹¨í•©ë‹ˆë‹¤. ì£¼ì–´ì§„ Linearization Gadget $\mathbf w_{ij}$ì™€ ì•”í˜¸ë¬¸ì˜ ê³± $(b_{ij})_{1\le i,j\le n}$ ì— ëŒ€í•´ ($i,j \neq 0$ì„ì— ì£¼ì˜), ë‹¤ìŒì„ ê³„ì‚°í•©ë‹ˆë‹¤:

$$c_{lin} := \sum_{1\le i,j\le n} b_{ij} \mathbf w_{ij} $$

$c_{lin}$ì€ $w_{ij}$ì˜ linear combination ì´ë¯€ë¡œ $(n+1)$ dimension ë²¡í„°ì…ë‹ˆë‹¤.

### Correctness
ì´ì œ motivationì„ ì–»ê¸° ìœ„í•´ $c_{lin}=(c_{lin0}, \mathbf c_{lin1})$ì„ ë³µí˜¸í™” í•´ë³´ê² ìŠµë‹ˆë‹¤. ë³µí˜¸í™”ëŠ” $(1, \mathbf s)$ ë²¡í„°ì™€ ë‚´ì  ì—°ì‚°ê³¼ ë™ì¼í•©ë‹ˆë‹¤. ë³µí˜¸í™” ì—°ì‚° (ë‚´ì )ì´ linearí•˜ë‹¤ëŠ” ê²ƒìœ¼ë¡œë¶€í„° ë‹¤ìŒê³¼ ê°™ì´ ê³„ì‚°ë©ë‹ˆë‹¤:

$$\begin{split}
r_{lin} &= c_{lin0} + \mathbf c_{lin1} \cdot s \\
&= \mathbf c_{lin}\cdot (1, \mathbf s) \\
&= (\sum_{1\le i,j\le n} b_{ij} \mathbf w_{ij}) \cdot (1, \mathbf s) \\
&= \sum_{1\le i,j\le n} b_{ij} [ \mathbf w_{ij} \cdot (1, \mathbf s) ] \\
&= \sum_{1\le i,j\le n} b_{ij} [ w_{ij0} + \mathbf w_{ij1} \cdot \mathbf s\ ] \\
&= \sum_{1\le i,j\le n} b_{ij} r_{ij}
= \sum_{1\le i,j\le n} b_{ij} (s_is_j) + 2\left(\sum_{1\le i,j\le n} b_{ij} e_{ij}\right)
\end{split}$$

ê·¸ ê²°ê³¼, ìš°ë¦¬ê°€ ê³„ì‚°í•œ $c_{lin}$ì´ ì‚¬ì‹¤ì€ $\sum_{1\le i,j\le n} b_{i,j}(s_is_j)$ ê°€ í‰ë¬¸ì´ê³  ë…¸ì´ì¦ˆë¡œ $e_{lin} = \sum_{1\le i,j\le n} b_{ij} e_{ij}$ ë¥¼ ê°€ì§€ëŠ” ì•”í˜¸ë¬¸ì´ë¼ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

## Better try
ì´ ì•”í˜¸ë¬¸ì´ ë³µí˜¸í™” ë˜ë ¤ë©´ ë…¸ì´ì¦ˆ $e_{lin}$ì´ modulus ê¸°ì¤€ $q$ì— ë¹„í•´ ì‘ì•„ì•¼í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ $b_{ij}$ì˜ ë¹„íŠ¸ í‘œê¸°ë²•ì„ ì‚¬ìš©í•˜ì—¬ ë…¸ì´ì¦ˆì˜ í¬ê¸°ë¥¼ ì‘ê²Œ ë§Œë“œëŠ” ë°©ë²•ì„ ì†Œê°œí•˜ê² ìŠµë‹ˆë‹¤.

ë¨¼ì € lineariation gadgetì„ ëª¨ë“  $i,j$ì— ëŒ€í•´ ë‹¤ìŒê³¼ ê°™ì´ $k=0,1,2,\cdots,\log q$ ë§Œí¼ ë” ë§Œë“¤ì–´ì¤ë‹ˆë‹¤. ì´ ë•Œ gadgetì€ $s_is_j$ê°€ ì•„ë‹Œ $2^k s_is_j$ë¥¼ ì•”í˜¸í™”í•˜ì—¬ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤:

$$\mathbf w_{ijk}=(w_{ijk0}, \mathbf w_{ijk1})$$

$$w_{ijk0} := -\mathbf w_{ijk1}\cdot \mathbf s + r_{ijk}$$

$$r_{ijk} := 2^k s_is_j+2e_{ij}$$

ì´ì œ linearization processë¥¼ $b_{ij}$ì˜ ë¹„íŠ¸ ê¸°ì¤€ìœ¼ë¡œ ìˆ˜í–‰í•´ì¤ë‹ˆë‹¤. ì´ ë•Œ $b_{ijk}$ëŠ” $b_{ij}$ì˜ kë²ˆì§¸ ë¹„íŠ¸ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

$$c_{lin} := \sum_{i,j,k} b_{ijk} \mathbf w_{ijk} $$

ì´ ê²½ìš° ì „ì— í–ˆë˜ê²ƒê³¼ ë™ì¼í•˜ê²Œ ë³µí˜¸í™”ë¥¼ í•´ë³´ë©´,

$$\begin{split}
r_{lin} &= \mathbf c_{lin}\cdot (1, \mathbf s) \\
&= (\sum_{i,j,k} b_{ijk} \mathbf w_{ijk}) \cdot (1, \mathbf s)
= \sum_{i,j,k} b_{ijk} [ \mathbf w_{ijk} \cdot (1, \mathbf s) ] \\
&= \sum_{i,j,k} b_{ijk} (2^k s_is_j+2e_{ij})
= \sum_{i,j,k} 2^k b_{ijk} (s_is_j) + 2\sum_{i,j,k} b_{ijk} e_{ij} \\

&= \sum_{1\le i,j\le n} b_{ij} (s_is_j) + 2\left (\sum_{i,j,k} b_{ijk} e_{ij}\right )
\end{split}$$

ìœ„ì™€ ê°™ì´ í‰ë¬¸ì€ ì—¬ì „íˆ $\sum_{1\le i,j\le n} b_{i,j}(s_is_j)$ ì´ì§€ë§Œ, ë…¸ì´ì¦ˆëŠ” $e_{lin} = \sum_{i,j,k} b_{ijk} e_{ijk}$ ë¡œ ë³€í•œ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
$b_{ijk}$ëŠ” 0 ë˜ëŠ” 1ì˜ ê°’ì„ ê°€ì§„ë‹¤ëŠ” ê²ƒì„ ìƒê°í•˜ë©´ ë…¸ì´ì¦ˆëŠ” $q$ì— ë¹„í•´ ì¶©ë¶„íˆ ì‘ì€ ê°’ì„ ê°€ì§‘ë‹ˆë‹¤.

## Putting all together

ì§€ê¸ˆê¹Œì§€ì˜ ë‚´ìš©ë“¤ì„ ì´ì •ë¦¬ í•´ë³´ê² ìŠµë‹ˆë‹¤. 
BGVì—ì„œ ë‘ ì•”í˜¸ë¬¸ì„ ê³±í•˜ë©´ ë‘˜ì˜ tensor product $c_{mul}$ì´ ë‚˜ì™”ìŠµë‹ˆë‹¤. 

$$c_{mul}=c\otimes c'=(b_{0, 0}, b_{0, 1}, \cdots, b_{i, j}, \cdots, b_{n, n})\in \mathbb{Z}_q^{(n+1)^2}$$

ê·¸ë¦¬ê³  ìš°ë¦¬ëŠ” $c_{mul}$ì„ ë‹¤ìŒê³¼ ê°™ì´ ë³µí˜¸í™”í•´ì„œ $r_{mul}=rr'$, ì›ë˜ í‰ë¬¸ì˜ ê³±ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
$$r_{mul}=rr'=b_{0,0}+\sum_{i=1}^{n}(b_{0,i}+b_{i,0})s_i+\sum_{i,j}^{n}b_{i,j}(s_is_j)$$

í•˜ì§€ë§Œ ë¬¸ì œëŠ” ì•”í˜¸ë¬¸ì´ $c\otimes c'$ì´ ë˜ì—ˆê³ , ë³µí˜¸í™”í•˜ëŠ”ë° $s\otimes s$ê°€ í•„ìš”í•˜ë‹¤ë³´ë‹ˆ dimensionì´ $n^2$ìœ¼ë¡œ ì¦ê°€í–ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ linearizationì„ í•´ì¤ë‹ˆë‹¤.

Better Tryì—ì„œ ë„ì…í•œ linearization gadget $\mathbf w_{ijk}$ ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
linearization ê³¼ì •ì—ì„œ ì•”í˜¸ë¬¸ $\mathbf c_{lin}$ì„ ì–»ì—ˆê³ , ì´ì œ ìµœì¢… ì•”í˜¸ë¬¸ $\mathbf c_{out}$ì„ ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•´ì¤ë‹ˆë‹¤ (ë²¡í„° ë§ì…ˆì— ìœ ì˜):

$$\mathbf c_{out}=(c_0,c_1,\cdots,c_n)=(b_{0,0}, b_{0,1}+b_{1,0}, \cdots, b_{0,n}+b_{n,0}) + \mathbf c_{lin}$$

### Correctness

$c_{out}$ì„ ë³µí˜¸í™”í•´ì„œ $r_{out}$ì„ ê³„ì‚°í•´ë´…ì‹œë‹¤.

$$\begin{split}
r_{out} &= \mathbf c_{out}\cdot (1, \mathbf s) \\
&= [(b_{0,0}, b_{0,1}+b_{1,0}, \cdots, b_{0,n}+b_{n,0}) + \mathbf c_{lin}] \cdot (1, \mathbf s) \\
&= (b_{0,0}, b_{0,1}+b_{1,0}, \cdots, b_{0,n}+b_{n,0})\cdot (1, \mathbf s) + \mathbf c_{lin} \cdot (1, \mathbf s) \\

&= b_{0,0}+\sum_{i=1}^{n}(b_{0,i}+b_{i,0})s_i + r_{lin} \\

&= b_{0,0}+\sum_{i=1}^{n}(b_{0,i}+b_{i,0})s_i + \sum_{1\le i,j\le n} b_{ij} (s_is_j) + 2e_{lin} \\

&= r_{mul} + 2e_{lin}.
\end{split}$$

$r_{mul}=rr'=(m+2e)(m'+2e')$ ì—ì„œ í‰ë¬¸ë§Œ ë‚¨ê¸°ê³  $r_{out}$ì„ ì •ë¦¬í•˜ë©´,

$$r_{out}=(m+2e)(m'+2e')+2e_{lin}=mm'+2(me'+m'e+2ee'+e_{lin}) =mm'+2e^*$$

ê°€ ë©ë‹ˆë‹¤. ì¦‰, ìš°ë¦¬ê°€ ì •ì˜í•œ $\mathbf c_{out}$ì€ dimensionì´ $(n+1)$ì´ë©´ì„œ, í‰ë¬¸ $mm'$ì™€ ë…¸ì´ì¦ˆ $e^*$ë¥¼ ê°€ì§‘ë‹ˆë‹¤. ì´ê²ƒì€ ìš°ë¦¬ê°€ ì²˜ìŒë¶€í„° ëª©í‘œë¡œ í–ˆë˜ ì¡°ê±´ì…ë‹ˆë‹¤! ğŸš€


## Conclusion

BGV schemeì˜ ê³±ì…ˆ ì—°ì‚°ì—ì„œ ë°œìƒí•˜ëŠ” ì°¨ì› ì¦ê°€ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì„ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤. ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ì´ ê¸€ì—ì„œë„ ì–¸ê¸‰í•œ Noise Reductionì— ëŒ€í•´ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.
